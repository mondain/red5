<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans>

	<!-- This file just wires together the context tree. Its accessed by ContextSingletonBeanFactoryLocator -->

	<!-- First we load the common context, its shared between all the other contexts -->
	<!-- Global context serves are the parent to all child contexts. -->
	<bean id="red5.common"
  	    class="org.springframework.context.support.FileSystemXmlApplicationContext">
    	<constructor-arg><list><value>classpath:/red5-common.xml</value></list></constructor-arg>
	</bean>
	
	<!-- Then we load the core context, with the common as parent --> 
	<!-- Context holding all the networking, users should need to edit. -->
	<bean id="red5.core"
  	    class="org.springframework.context.support.FileSystemXmlApplicationContext">
    	<constructor-arg><list><value>classpath:/red5-core.xml</value></list></constructor-arg>
    	<constructor-arg><ref bean="red5.common" /></constructor-arg>
	</bean>
	
	<!-- Then we load the global contexts, note its important this happens before jetty loads -->
	<bean id="context.loader" 
		class="org.red5.server.ContextLoader"
		init-method="init">
		<property name="parentContext" ref="red5.common" />
		<property name="contextsConfig" value="red5.globals" />
	</bean>
	
	<!-- Now we can load the servlet engine, this has to happen after the context are loaded -->
	<!-- bean id="jetty6.server" class="org.red5.server.JettyLoader" init-method="init" autowire="byType" / -->
	<bean id="tomcat.server" class="org.red5.server.TomcatLoader" init-method="init" autowire="byType">
	    <!-- Use this to configure Tomcat via Spring -->
	    <property name="embedded">
	    	<bean class="org.apache.catalina.startup.Embedded" />
	    </property>
	    
	    <!-- This Realm uses the UserDatabase configured in the global JNDI
	        resources under the key "UserDatabase". Any edits that are performed
	        against this UserDatabase are immediately available for use by the Realm. - - > 
	    <property name="realm">
		    <bean class="org.apache.catalina.realm.UserDatabaseRealm">
		        <property name="resourceName">
		            <bean id="UserDatabase" class="org.apache.catalina.UserDatabase">
		                <property name="auth" value="Container" />
		                <property name="factory" value="org.apache.catalina.users.MemoryUserDatabaseFactory" />
		                <property name="pathname" value="conf/tomcat-users.xml" />             
		            </bean>
		        </property>
		    </bean>            
		</property>
		-->
	    
	    <!-- Comment out the old realm but leave here for now in case we
	       need to go back quickly -->
	    <property name="realm">
	    	<bean class="org.apache.catalina.realm.MemoryRealm" />
		</property>
			      
	    <!-- Replace the above Realm with one of the following to get a Realm
	       stored in a database and accessed via JDBC - - >
	    <property name="realm">   
		    <bean class="org.apache.catalina.realm.JDBCRealm">
		        <property name="driverName">
		            <bean id="UserDatabase" class="org.gjt.mm.mysql.Driver">
		                <property name="connectionURL" value="jdbc:mysql://localhost/authority" />
		                <property name="connectionName" value="test" />
		                <property name="connectionPassword" value="test" />
		                <property name="userTable" value="users" />
		                <property name="userNameCol" value="user_name" />
		                <property name="userCredCol" value="user_pass" />             
		                <property name="userRoleTable" value="user_roles" />             
		                <property name="roleNameCol" value="role_name" />             
					</bean>
		        </property>
		    </bean>  
	    </property>
	    -->      
	      
		<!-- ================ Connectors ================     
	    Define a non-SSL HTTP/1.1 Connector on port 8080 -->
	    <property name="connector">
			<bean class="org.apache.catalina.connector.http.HttpConnector">
		        <property name="port"><value>${http.port}</value></property>
		        <property name="maxHttpHeaderSize" value="8192" />
		        <property name="maxThreads" value="150" />
		        <property name="minSpareThreads" value="25" />
		        <property name="maxSpareThreads" value="75" />
		        <property name="enableLookups" value="false" />
		        <property name="redirectPort" value="8443" />
		        <property name="acceptCount" value="100" />
		        <!-- Note : To disable connection timeouts, set connectionTimeout value to 0 -->
		        <property name="connectionTimeout" value="20000" />
		        <property name="disableUploadTimeout" value="true" />
		        <!-- Note : To use gzip compression you could set the following properties :
		            <property name="compression" value="on" />
		            <property name="compressionMinSize" value="2048" />
					<property name="noCompressionUserAgents"><value>gozilla, traviata</value></property> 
					<property name="compressableMimeType"><value>text/html,text/xml</value></property>
			    -->
			</bean>
	    </property>
	    	
	    <!-- Define a SSL HTTP/1.1 Connector on port 8443 - - >
	    <property name="connector.https">
			<bean class="org.apache.catalina.connector.http.HttpConnector">
		        <property name="port"><value>${https.port}</value></property>
		        <property name="maxHttpHeaderSize"><value>8192</value></property>
		        <property name="maxThreads"><value>150</value></property>
		        <property name="minSpareThreads"><value>25</value></property>
		        <property name="maxSpareThreads"><value>75</value></property>
		        <property name="enableLookups"><value>false</value></property>
		        <property name="acceptCount"><value>100</value></property>
		        <property name="scheme"><value>https</value></property>
		        <property name="secure"><value>true</value></property>
		        <property name="clientAuth"><value>false</value></property>
		        <property name="sslProtocol"><value>TLS</value></property>
		        <!- - Note : To disable connection timeouts, set connectionTimeout value to 0 - ->
		        <property name="connectionTimeout"><value>20000</value></property>
		        <property name="disableUploadTimeout"><value>true</value></property>
			</bean>	  
	    </property>		  
		-->
	
	    <!-- Define an AJP 1.3 Connector on port 8009 - - >
	    <property name="connector.ajp">
			<bean class="org.apache.coyote.tomcat5.CoyoteConnector">
		        <property name="port"><value>${ajp.port}</value></property>
		        <property name="maxHttpHeaderSize" value="8192" />
		        <property name="maxThreads" value="150" />
		        <property name="minSpareThreads" value="25" />
		        <property name="maxSpareThreads" value="75" />
		        <property name="enableLookups" value="false" />
		        <property name="redirectPort" value="8443" />
		        <property name="acceptCount" value="100" />
		        <property name="protocol"><value>AJP/1.3</value></property>
		        <property name="protocolHandlerClassName">
		            <bean class="org.apache.jk.server.JkCoyoteHandler" />
		        </property>
		        <!- - Note : To disable connection timeouts, set connectionTimeout value to 0 - - >
		        <property name="connectionTimeout" value="20000" />
		        <property name="disableUploadTimeout" value="true" />
			</bean>	   
	    </property>
	    -->
	    
	    <!-- ================ Engines ================
	    You should set jvmRoute to support load-balancing via AJP ie : - - >
	    <property name="engine.standalone">
			<bean class="org.apache.catalina.core.StandardEngine">
		        <property name="defaultHost" value="localhost" />
		        <property name="jvmRoute" value="jvm1" />
			</bean>	   
	    </property>		
	    --> 
	  
	    <!-- Define the top level container in our container hierarchy -->
	    <property name="engine">
			<bean class="org.apache.catalina.core.StandardEngine">
		        <property name="defaultHost">
			        <bean class="org.apache.catalina.core.StandardHost">
			            <property name="name" value="${http.host}" />
			            <property name="appBase" value="${red5.root}/webapps" />
			            <property name="unpackWARs" value="true" />
			            <property name="autoDeploy" value="true" />
			            <property name="xmlValidation" value="false" />
			            <property name="xmlNamespaceAware" value="false" />
			        <!--
			            <bean id="valve.access" class="org.apache.catalina.valves.AccessLogValve">
			                 <property name="directory" value="logs" />
			                 <property name="prefix" value="localhost_access_log." />
			                 <property name="suffix" value=".txt" />
			                 <property name="pattern" value="common"" />
			                 <property name="resolveHosts" value="false"/>
			            </bean>
			        -->
			        </bean>	   
	    		</property>		
			</bean>	   	
	    </property>	
	</bean>
	
	<!-- Default context. This can be shared between web app contexts -->
	<!--
	<bean id="default.context"
  	    class="org.springframework.context.support.FileSystemXmlApplicationContext">
    	<constructor-arg><value>/webapps/red5-default.xml</value></constructor-arg>
    	<constructor-arg><ref bean="red5.common" /></constructor-arg>
	</bean>
	-->
	<!-- You can add further contexts here. This allows for multiple separate global scopes -->
	
</beans>
