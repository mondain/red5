<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<!-- =============================================================== -->
<!-- Configure the Jetty Server with Spring                          -->
<!-- This file is the equivalent of jetty.xml, but written in spring -->
<!-- XmlBeanFactory format.                                          -->
<!-- The modules/spring/src/org/mortbay/spring/Main.java may be used -->
<!-- to run this file - or any other spring infrastructure that      -->
<!-- accepts uses an XmlBeanFactory                                  -->
<!-- =============================================================== -->
<beans>

	<bean id="sysProps" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetClass"><value>java.lang.System</value></property>
		<property name="targetMethod"><value>getProperties</value></property>
	</bean>

	<bean id="webappRoot"
		class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetObject">
			<ref bean="sysProps" />
		</property>
		<property name="targetMethod">
			<value>getProperty</value>
		</property>
		<property name="arguments">
			<list>
				<value>red5.webapp.root</value>
			</list>
		</property>
	</bean>

	<bean id="httpPort"
		class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetObject">
			<ref bean="sysProps" />
		</property>
		<property name="targetMethod">
			<value>getProperty</value>
		</property>
		<property name="arguments">
			<list>
				<value>http.port</value>
			</list>
		</property>
	</bean>

	<bean id="jettyWebCtx" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetClass"><value>org.mortbay.jetty.webapp.WebAppContext</value></property>
		<property name="targetMethod"><value>getCurrentWebAppContext</value></property>
	</bean>

	<bean id="webappContext" class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="targetObject">
			<ref bean="jettyWebCtx" />
		</property>
		<property name="targetMethod">
			<value>addWebApplications</value>
		</property>
		<property name="arguments">
			<list>
				<ref local="Server" />
				<ref local="webappRoot" />
				<value>web-default.xml</value>
				<list>
					<value>
						org.mortbay.jetty.webapp.WebInfConfiguration
					</value>
					<value>
						org.mortbay.jetty.webapp.WebXmlConfiguration
					</value>
					<value>
						org.mortbay.jetty.webapp.JettyWebXmlConfiguration
					</value>
					<value>
						org.mortbay.jetty.webapp.TagLibConfiguration
					</value>
					<value>
						org.red5.server.jetty.Red5WebPropertiesConfiguration
					</value>
				</list>
				<value>true</value>
				<value>true</value>
			</list>
		</property>
	</bean>

	<bean id="Server" class="org.mortbay.jetty.Server" init-method="start" destroy-method="stop">

		<property name="threadPool">
			<bean id="ThreadPool"
				class="org.mortbay.thread.BoundedThreadPool">
				<property name="minThreads" value="10" />
				<property name="lowThreads" value="25" />
				<property name="maxThreads" value="100" />
			</bean>
		</property>

		<property name="connectors">
			<list>
				<bean id="Connector"
					class="org.mortbay.jetty.nio.SelectChannelConnector">
					<property name="port">
						<ref local="httpPort" />
					</property>
					<property name="maxIdleTime" value="30000" />
					<property name="acceptors" value="2" />
					<property name="confidentialPort" value="8443" />
				</bean>
			</list>
		</property>

		<property name="handler">
			<bean id="handlers" class="org.mortbay.jetty.handler.HandlerCollection">
				<property name="handlers">
					<list>
						<bean id="contexts" class="org.mortbay.jetty.handler.ContextHandlerCollection">
							<property name="handlers">
								<list>
									<bean
										class="org.mortbay.jetty.webapp.WebAppContext">
										<property name="contextPath" value="/" />
										<property name="war" value="webapps/root" />
									</bean>
									<bean
										class="org.mortbay.jetty.webapp.WebAppContext">
										<property name="contextPath" value="/admin" />
										<property name="war" value="webapps/admin" />
									</bean>     
									<bean
										class="org.mortbay.jetty.webapp.WebAppContext">
										<property name="contextPath" value="/dump" />
										<property name="war" value="webapps/dump" />
									</bean>     
									<bean
										class="org.mortbay.jetty.webapp.WebAppContext">
										<property name="contextPath" value="/fitcDemo" />
										<property name="war" value="webapps/fitcDemo" />
									</bean>
									<bean
										class="org.mortbay.jetty.webapp.WebAppContext">
										<property name="contextPath" value="/messageRecorder" />
										<property name="war" value="webapps/messageRecorder" />
									</bean>
									<bean
										class="org.mortbay.jetty.webapp.WebAppContext">
										<property name="contextPath" value="/midiDemo" />
										<property name="war" value="webapps/midiDemo" />
									</bean>
									<bean
										class="org.mortbay.jetty.webapp.WebAppContext">
										<property name="contextPath" value="/oflaDemo" />
										<property name="war" value="webapps/oflaDemo" />
									</bean>
									<bean
										class="org.mortbay.jetty.webapp.WebAppContext">
										<property name="contextPath" value="/SOSample" />
										<property name="war" value="webapps/SOSample" />
									</bean>
									<bean
										class="org.mortbay.jetty.webapp.WebAppContext">
										<property name="contextPath" value="/test" />
										<property name="war" value="webapps/test" />
									</bean>
									<bean
										class="org.mortbay.jetty.webapp.WebAppContext">
										<property name="contextPath" value="/tutorial" />
										<property name="war" value="webapps/tutorial" />
									</bean>
								</list>
							</property>
						</bean>
						<bean id="defaultHandler" class="org.mortbay.jetty.handler.DefaultHandler" />
						<!-- bean id="requestLog" class="org.mortbay.jetty.handler.RequestLogHandler"/ -->
					</list>
				</property>
			</bean>
		</property>

		<property name="userRealms">
			<list>
				<bean
					class="org.mortbay.jetty.security.HashUserRealm">
					<property name="name" value="Test Realm" />
					<property name="config"	value="conf/realm.properties" />
				</bean>
			</list>
		</property>

	</bean>

</beans>
